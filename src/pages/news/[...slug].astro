---
// src/pages/news/[...slug].astro
import { getCollection } from "astro:content";
import BlogPost from "@/layouts/BlogPost";
import client from "../../../tina/__generated__/client";
import AdminBlogPost from "../../../tina/pages/AdminBlogPost";

export async function getStaticPaths() {
  const posts = await getCollection("news");

  return posts.map((post) => ({
    params: { slug: post.id },
    props: {
      post,
      getTinaProps: async () =>
        client.queries.news({
          relativePath: post.data.tinaInfo.relativePath,
        }),
    },
  }));
}

const { post, getTinaProps } = Astro.props;
const tinaProps = await getTinaProps();

// 確保日期是 Date 物件
const pubDate =
  post.data.pubDate instanceof Date
    ? post.data.pubDate
    : new Date(post.data.pubDate);
---

<BlogPost
  title={post.data.title}
  description={post.data.description}
  pubDate={pubDate}
  heroImage={post.data.heroImage}
  category={post.data.category}
  tags={post.data.tags}
>
  <AdminBlogPost {...tinaProps} client:tina />
</BlogPost>
