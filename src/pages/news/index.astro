---
// src/pages/news/index.astro
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";

// 獲取所有新聞文章
const allPosts = await getCollection("news");

// 按發布日期排序（最新的在前）
const sortedPosts = allPosts.sort((a, b) => {
    const dateA = a.data.pubDate instanceof Date ? a.data.pubDate : new Date(a.data.pubDate);
    const dateB = b.data.pubDate instanceof Date ? b.data.pubDate : new Date(b.data.pubDate);
    return dateB.getTime() - dateA.getTime();
});

// 分類標籤映射
const categoryLabels: Record<string, string> = {
    press: "新聞稿",
    events: "活動資訊",
    issues: "議題發言",
    clarification: "闢謠專區",
};
---

<Layout title="新聞稿" description="社會民主黨最新消息">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold mb-8">新聞稿</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {
                sortedPosts.map((post) => (
                    <article class="card bg-base-100 shadow-xl">
                        {post.data.heroImage && (
                            <figure>
                                <img
                                    src={post.data.heroImage}
                                    alt={post.data.title}
                                    class="w-full h-48 object-cover"
                                />
                            </figure>
                        )}
                        <div class="card-body">
                            <div class="flex gap-2 mb-2">
                                {post.data.category && (
                                    <span class="badge badge-primary">
                                        {categoryLabels[post.data.category] || post.data.category}
                                    </span>
                                )}
                            </div>
                            <h2 class="card-title">{post.data.title}</h2>
                            <p class="text-gray-600 line-clamp-2">{post.data.description}</p>
                            <div class="text-sm text-gray-500">
                                {post.data.pubDate && (
                                    <time datetime={post.data.pubDate instanceof Date 
                                        ? post.data.pubDate.toISOString() 
                                        : new Date(post.data.pubDate).toISOString()}>
                                        {(post.data.pubDate instanceof Date 
                                            ? post.data.pubDate 
                                            : new Date(post.data.pubDate)
                                        ).toLocaleDateString("zh-TW", {
                                            year: "numeric",
                                            month: "long",
                                            day: "numeric",
                                        })}
                                    </time>
                                )}
                            </div>
                            <div class="card-actions justify-end mt-4">
                                <a
                                    href={`/news/${post.id}`}
                                    class="btn btn-primary btn-sm"
                                >
                                    閱讀更多
                                </a>
                            </div>
                        </div>
                    </article>
                ))
            }
        </div>

        {sortedPosts.length === 0 && (
            <div class="text-center py-12">
                <p class="text-xl text-gray-500">目前沒有文章</p>
            </div>
        )}
    </div>
</Layout>
