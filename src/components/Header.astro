---
import IconLink from "./react/IconLink";
const config = await import("../content/config/config.json");

const menuItems = [
    { label: "Homepage", href: "/" },
    { label: "Portfolio", href: "/portfolio" },
    { label: "About", href: "/about" },
    { label: "加入我們", href: "/join" },
    { label: "捐款支持", href: "https://sdparty.oen.tw/#" },
];

const socialLinks = [
    { name: "Facebook", url: "https://www.facebook.com/sdparty.tw" },
    { name: "Instagram", url: "https://www.instagram.com/sdparty.tw/" },
    { name: "Threads", url: "https://www.threads.net/sdparty.tw" },
    { name: "YouTube", url: "https://www.youtube.com/@sdpartytw" },
    { name: "Line@", url: "https://twitter.com/sdparty_tw" },
];
---

<nav class="navbar bg-base-100 shadow-sm fixed top-0 w-full z-50">
    <div class="navbar-start">
        <label class="btn btn-circle swap swap-rotate" id="menu-toggle">
            <input type="checkbox" id="menu-checkbox" />
            <svg
                class="swap-off fill-current"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 512 512"
            >
                <path
                    d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z"
                ></path>
            </svg>
            <svg
                class="swap-on fill-current"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 512 512"
            >
                <polygon
                    points="400 145.49 366.51 112 256 222.51 145.49 112 112 145.49 222.51 256 112 366.51 145.49 400 256 289.49 366.51 400 400 366.51 289.49 256 400 145.49"
                ></polygon>
            </svg>
        </label>
    </div>

    <div class="navbar-center">
        <h2 class="text-md">
            <a href="/">{config.seo.title}</a>
        </h2>
    </div>

    <div class="navbar-end gap-2">
        <a href="/join" class="btn btn-primary btn-sm">加入我們</a>
        <a
            href="https://sdparty.oen.tw/#"
            target="_blank"
            class="btn btn-secondary btn-sm">捐款支持</a
        >
    </div>
</nav>

<!-- 全螢幕選單 HTML -->
<div id="fullscreen-menu" class="fullscreen-menu">
    <div class="fullscreen-menu__content">
        <nav class="fullscreen-menu__nav">
            {
                menuItems.map((item) => (
                    <div class="menu-link">
                        <a href={item.href}>{item.label}</a>
                    </div>
                ))
            }
        </nav>

        <div class="fullscreen-menu__socials">
            {
                socialLinks.map((link) => (
                    <a
                        href={link.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="menu-social-link"
                    >
                        {link.name}
                    </a>
                ))
            }
        </div>
    </div>
</div>

<script>
    import gsap from "gsap";
    import CustomEase from "gsap/CustomEase";

    // 註冊 GSAP
    gsap.registerPlugin(CustomEase);
    CustomEase.create(
        "hop",
        "M0,0 C0.354,0 0.464,0.133 0.498,0.502 0.532,0.872 0.651,1 1,1",
    );

    const menu = document.getElementById("fullscreen-menu");
    const checkbox = document.getElementById(
        "menu-checkbox",
    ) as HTMLInputElement;
    const links = menu?.querySelectorAll(".menu-link");
    const socialLinks = menu?.querySelectorAll(".menu-social-link");

    if (menu && links && socialLinks) {
        // 初始化狀態
        gsap.set(menu, {
            clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
        });
        gsap.set(links, { y: 30, opacity: 0 });
        gsap.set(socialLinks, { y: 30, opacity: 0 });

        // 動畫函式
        const animateMenu = (open: boolean) => {
            if (open) {
                gsap.to(menu, {
                    clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
                    ease: "hop",
                    duration: 1.5,
                    onStart: () => {
                        (menu as HTMLElement).style.pointerEvents = "all";
                        document.body.classList.add("menu-open");
                    },
                });

                gsap.to(links, {
                    y: 0,
                    opacity: 1,
                    stagger: 0.1,
                    delay: 0.85,
                    duration: 1,
                    ease: "power3.out",
                });

                gsap.to(socialLinks, {
                    y: 0,
                    opacity: 1,
                    stagger: 0.05,
                    delay: 0.85,
                    duration: 1,
                    ease: "power3.out",
                });
            } else {
                gsap.to(menu, {
                    clipPath: "polygon(0% 0%, 100% 0%, 100% 0%, 0% 0%)",
                    ease: "hop",
                    duration: 1.5,
                    onComplete: () => {
                        (menu as HTMLElement).style.pointerEvents = "none";
                        document.body.classList.remove("menu-open");
                        gsap.set(menu, {
                            clipPath:
                                "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
                        });
                        gsap.set(links, { y: 30, opacity: 0 });
                        gsap.set(socialLinks, { y: 30, opacity: 0 });
                    },
                });
            }
        };

        // 監聽 checkbox 變化
        checkbox?.addEventListener("change", (e) => {
            animateMenu((e.target as HTMLInputElement).checked);
        });

        // 點擊連結關閉選單
        const allLinks = menu.querySelectorAll("a");
        allLinks.forEach((link) => {
            link.addEventListener("click", () => {
                checkbox.checked = false;
                animateMenu(false);
            });
        });
    }
</script>

<style>
    @import "../components/FullscreenMenu/fullscreen-menu.css";

    h2 a {
        text-decoration: none;
        color: inherit;
    }

    nav {
        backdrop-filter: blur(10px);
    }
    .fullscreen-menu {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: #eb5078 !important; /* 強制覆蓋 DaisyUI */
        color: #fff !important;
        clip-path: polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%);
        pointer-events: none;
        z-index: 9998;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .menu-link a::after,
    .menu-link a:hover::after {
        background-color: #fff !important;
    }
    /* 確保 navbar 在全螢幕選單之上 */
    nav.navbar {
        z-index: 9999 !important;
        position: relative;
    }

    /* 確保選單按鈕在最上層 */
    #menu-toggle {
        z-index: 10000 !important;
        position: relative;
    }
</style>
